## Анализ поведения покупателей в онлайн‑магазине

**Тема:** анализ поведения покупателей в онлайн‑магазине  
**Цель:** **сегментировать покупателей по паттернам поведения и выявить ключевые факторы покупки/подписки.**

### Что делает этот проект
- **EDA и очистка данных** – изучение структуры, пропусков, выбросов, распределений и корреляций (`01_eda.ipynb`).  
- **Кластеризация покупателей** – применение **KMeans** и **DBSCAN**, оценка качества кластеров по **Silhouette Score** (`02_clustering.ipynb`).  
- **Построение профилей сегментов** – описание получившихся кластеров по признакам (возраст, сумма покупок, скидки, промокоды и т.д., `03_cluster_profiles.ipynb`).  
- **Классификация** – обучение моделей **RandomForest** и **SVM** для прогноза целевой переменной (подписка/покупка) и выбор лучшей по **ROC‑AUC** (`04_classification.ipynb`, `main.py`).  
- **Визуализация** – сохранение графиков сегментов, ROC‑кривых и важности признаков в `results/figures` 

### Описание датасета
- **Объект анализа:** покупки и поведение клиентов онлайн‑магазина.  
- **Размер:** ~3900 строк, один клиент на одну покупку.  
- **Основные группы признаков:**
  - **Числовые**: возраст (`Age`), сумма покупки в долларах (`Purchase Amount (USD)`), рейтинг отзыва (`Review Rating`), количество предыдущих покупок (`Previous Purchases`).  
  - **Категориальные**: пол (`Gender`), купленный товар (`Item Purchased`), категория (`Category`), локация (`Location`), размер (`Size`), цвет (`Color`), сезон (`Season`), тип доставки (`Shipping Type`), наличие скидки (`Discount Applied`), промокод (`Promo Code Used`), способ оплаты (`Payment Method`), частота покупок (`Frequency of Purchases`).  
- **Таргет / бизнес‑метрика:** поле `Subscription Status` (или производный бинарный признак «покупка/подписка»), по которому обучается классификационная модель.  

### Структура репозитория
- **`data/`**
  - `data/raw/shopping_behavior.csv` – исходный датасет *Shopping Behavior Dataset*. URL - https://www.kaggle.com/datasets/ahmadrazakashif/shopping-behavior-dataset 
  - `data/processed/` – место для сохранения обработанных данных (по желанию).  
- **`notebooks/`** – точка входа, если вы хотите сначала посмотреть эксперименты:
  - `01_eda.ipynb` – разведочный анализ и подготовка данных.  
  - `02_clustering.ipynb` – кластеризация (KMeans, DBSCAN) и Silhouette Score.  
  - `03_cluster_profiles.ipynb` – профили сегментов и их интерпретация.  
  - `04_classification.ipynb` – классификация, ROC‑кривые и важность признаков.  
- **`src/`**
  - `schema.py` – список числовых и категориальных признаков, ID‑колонки и таргета.  
  - `data_preprocessing.py` – единый пайплайн нормализации (медианная импутация + `StandardScaler` для числовых, мода + `OneHotEncoder` для категориальных).  
  - `clustering.py`, `modeling.py`, `evaluation.py`, `visualization.py`, `utils.py` – вспомогательные функции для кластеризации, обучения и оценки моделей.  
- **`main.py`** – скрипт, который запускает ключевые шаги пайплайна (кластеризация и классификация) без ноутбуков.  
- **`results/`**
  - `results/figures/` – сохранённые графики (кластеры, Silhouette Score, ROC, heatmap и т.д.).  
  - `results/reports/` – JSON‑отчёты с метриками.  
- **`models/`**
  - `best_model.joblib` – лучшая модель классификации (RandomForest или SVM по ROC‑AUC).  

### Этапы решения
1. **EDA, очистка и нормализация**
   - загрузка `shopping_behavior.csv`;  
   - проверка пропусков, дубликатов, типов;  
   - базовые графики распределений и корреляций;  
   - приведение признаков к удобному виду и построение пайплайна предобработки.  
2. **Кластеризация (KMeans, DBSCAN)**
   - нормализация признаков и при необходимости понижение размерности (PCA);  
   - перебор числа кластеров для KMeans и параметров `eps`, `min_samples` для DBSCAN;  
   - выбор лучшей конфигурации по **Silhouette Score** и визуализация сегментов.  
3. **Построение кластерных профилей**
   - сравнение средних значений признаков между сегментами;  
   - словесное описание сегментов (частота покупок, использование скидок, демография и т.п.).  
4. **Классификация (RandomForest, SVM)**
   - формирование целевого признака (подписка/покупка);  
   - обучение моделей RandomForest и SVM;  
   - сравнение по **ROC‑AUC**, выбор лучшей модели и сохранение её в `models/`;  
   - анализ важности признаков (permutation importance) и сохранение графиков.  

### Как запустить
- **Требования:**
  - Python 3.10+;  
  - `pip`.  

- **Шаги:**
  1. Установите зависимости:

```bash
pip install -r requirements.txt
```

  2. Скачайте *Shopping Behavior Dataset* и сохраните как:

```text
data/raw/shopping_behavior.csv
```

  3. Для интерактивного цикла (разобраться в задаче и коде) откройте ноутбуки в `notebooks/`.  
  4. Чтобы прогнать основной пайплайн из консоли, выполните:

```bash
python main.py
```

После выполнения вы получите обученную модель в `models/`, метрики в `results/reports/` и ключевые графики в `results/figures/`.

### С чего начать при первом открытии
- Хотите быстро понять **о чём данные** – откройте `01_eda.ipynb`.  
- Интересует **сегментация клиентов** – смотрите `02_clustering.ipynb` и `03_cluster_profiles.ipynb`.  
- Нужна **модель прогноза вероятности покупки/подписки** – переходите к `04_classification.ipynb` и смотрите ROC‑кривые и важность признаков.  

### Краткие выводы
- **Сегментация клиентов** показывает несколько устойчивых групп: активные покупатели, часто использующие скидки и промокоды; более редкие покупатели с высокой суммой чека; а также малоактивные клиенты.  
- По результатам permutation importance и моделей классификации ключевыми факторами покупки/подписки оказываются **использование промокода**, **наличие скидки**, а также характеристики покупателя и заказа (частота покупок, сумма покупки, пол, способ оплаты).  
- Модели **RandomForest** и **SVM** достигают ROC‑AUC около 0.89 на тестовой выборке, что позволяет достаточно надёжно оценивать вероятность покупки/подписки.  

Проект демонстрирует полный цикл: от анализа поведения покупателей и построения сегментов до разработки и интерпретации модели, прогнозирующей вероятность покупки.

